<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Retiros</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f4f4f4; }
        input, select, button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h2>Registro de Retiros</h2>
    <label>Nombre: <input type="text" id="nombre" required></label>
    <label>Centro de Costo: <input type="text" id="centro_costo" required></label>
    <label>Motivo de Retiro: <input type="text" id="motivo_retiro" required></label>
    <label>Fecha de Retiro: <input type="date" id="fecha_retiro" required></label>
    <label>Fecha de Reporte en IT Manager: <input type="date" id="fecha_reporte" required></label>
    <label>Punto de Venta: <input type="text" id="punto_venta" required></label>
    <label>Regional: <input type="text" id="regional" required></label>
    <label>Observaciones: <input type="text" id="observaciones"></label>
    <button onclick="agregarRetiro()">Agregar Retiro</button>
    
    <h3>Filtrar Retiros</h3>
    <label>Filtrar por Punto de Venta: <input type="text" id="filtro_punto" oninput="actualizarTabla()"></label>
    <label>Filtrar por Regional: <input type="text" id="filtro_regional" oninput="actualizarTabla()"></label>
    
    <table>
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Centro de Costo</th>
                <th>Motivo de Retiro</th>
                <th>Fecha de Retiro</th>
                <th>Fecha de Reporte en IT Manager</th>
                <th>Punto de Venta</th>
                <th>Regional</th>
                <th>Observaciones</th>
            </tr>
        </thead>
        <tbody id="tabla-retiros"></tbody>
    </table>
    
    <canvas id="graficoRetiros" width="400" height="200"></canvas>
    
    <script>
        let retiros = [];
        
        function agregarRetiro() {
            let nombre = document.getElementById('nombre').value;
            let centro_costo = document.getElementById('centro_costo').value;
            let motivo_retiro = document.getElementById('motivo_retiro').value;
            let fecha_retiro = document.getElementById('fecha_retiro').value;
            let fecha_reporte = document.getElementById('fecha_reporte').value;
            let punto_venta = document.getElementById('punto_venta').value;
            let regional = document.getElementById('regional').value;
            let observaciones = document.getElementById('observaciones').value;
            
            if (nombre && centro_costo && motivo_retiro && fecha_retiro && fecha_reporte && punto_venta && regional) {
                retiros.push({ nombre, centro_costo, motivo_retiro, fecha_retiro, fecha_reporte, punto_venta, regional, observaciones });
                actualizarTabla();
                actualizarGrafico();
                document.querySelectorAll('input').forEach(input => input.value = '');
            } else {
                alert("Por favor, completa todos los campos requeridos.");
            }
        }
        
        function actualizarTabla() {
            let tabla = document.getElementById('tabla-retiros');
            let filtroPunto = document.getElementById('filtro_punto').value.toLowerCase();
            let filtroRegional = document.getElementById('filtro_regional').value.toLowerCase();
            tabla.innerHTML = '';
            retiros.filter(ret => 
                ret.punto_venta.toLowerCase().includes(filtroPunto) &&
                ret.regional.toLowerCase().includes(filtroRegional)
            ).forEach(ret => {
                let fila = `<tr><td>${ret.nombre}</td><td>${ret.centro_costo}</td><td>${ret.motivo_retiro}</td><td>${ret.fecha_retiro}</td><td>${ret.fecha_reporte}</td><td>${ret.punto_venta}</td><td>${ret.regional}</td><td>${ret.observaciones}</td></tr>`;
                tabla.innerHTML += fila;
            });
        }
        
        function actualizarGrafico() {
            let ctx = document.getElementById('graficoRetiros').getContext('2d');
            let etiquetas = retiros.map(ret => ret.fecha_retiro);
            let datos = retiros.map((_, index) => index + 1);
            
            if (window.miGrafico) {
                window.miGrafico.destroy();
            }
            
            window.miGrafico = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: etiquetas,
                    datasets: [{
                        label: 'Cantidad de Retiros',
                        data: datos,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
    </script>
</body>
</html>
