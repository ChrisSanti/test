<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Retiros PDV</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h2>Registro de Retiros</h2>
    <form id="retiroForm">
        <label>Cédula:</label>
        <input type="text" id="cedula" required><br>
        <label>Nombre:</label>
        <input type="text" id="nombre" required><br>
        <label>Centro de Costo:</label>
        <input type="text" id="centroCosto" required><br>
        <label>Motivo de Retiro:</label>
        <input type="text" id="motivoRetiro" required><br>
        <label>Fecha de Retiro:</label>
        <input type="date" id="fechaRetiro" required><br>
        <label>Fecha de Reporte en IT Manager:</label>
        <input type="date" id="fechaReporte" required><br>
        <label>Punto de Venta:</label>
        <input type="text" id="puntoVenta" required><br>
        <label>Regional:</label>
        <input type="text" id="regional" required><br>
        <label>Observaciones:</label>
        <textarea id="observaciones"></textarea><br>
        <button type="submit">Registrar Retiro</button>
    </form>

    <h2>Historial de Retiros</h2>
    <label>Filtrar por Punto de Venta:</label>
    <input type="text" id="filtroPuntoVenta"><br>
    <label>Filtrar por Regional:</label>
    <input type="text" id="filtroRegional"><br>
    <button onclick="filtrarRetiros()">Filtrar</button>

    <table border="1">
        <thead>
            <tr>
                <th>Cédula</th>
                <th>Nombre</th>
                <th>Centro de Costo</th>
                <th>Motivo de Retiro</th>
                <th>Fecha de Retiro</th>
                <th>Fecha de Reporte</th>
                <th>Punto de Venta</th>
                <th>Regional</th>
                <th>Observaciones</th>
            </tr>
        </thead>
        <tbody id="tablaRetiros"></tbody>
    </table>

    <h2>Gráfica de Retiros</h2>
    <canvas id="graficaRetiros"></canvas>

    <script>
        let retiros = [];

        document.getElementById('retiroForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            let retiro = {
                cedula: document.getElementById('cedula').value,
                nombre: document.getElementById('nombre').value,
                centroCosto: document.getElementById('centroCosto').value,
                motivoRetiro: document.getElementById('motivoRetiro').value,
                fechaRetiro: document.getElementById('fechaRetiro').value,
                fechaReporte: document.getElementById('fechaReporte').value,
                puntoVenta: document.getElementById('puntoVenta').value,
                regional: document.getElementById('regional').value,
                observaciones: document.getElementById('observaciones').value
            };

            retiros.push(retiro);
            actualizarTabla();
            actualizarGrafico();
        });

        function actualizarTabla() {
            let tabla = document.getElementById('tablaRetiros');
            tabla.innerHTML = '';
            retiros.forEach(ret => {
                let row = `<tr>
                    <td>${ret.cedula}</td>
                    <td>${ret.nombre}</td>
                    <td>${ret.centroCosto}</td>
                    <td>${ret.motivoRetiro}</td>
                    <td>${ret.fechaRetiro}</td>
                    <td>${ret.fechaReporte}</td>
                    <td>${ret.puntoVenta}</td>
                    <td>${ret.regional}</td>
                    <td>${ret.observaciones}</td>
                </tr>`;
                tabla.innerHTML += row;
            });
        }

        function actualizarGrafico() {
            let ctx = document.getElementById('graficaRetiros').getContext('2d');
            let fechas = retiros.map(ret => ret.fechaRetiro);
            let cantidades = fechas.reduce((acc, fecha) => {
                acc[fecha] = (acc[fecha] || 0) + 1;
                return acc;
            }, {});

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(cantidades),
                    datasets: [{
                        label: 'Cantidad de Retiros',
                        data: Object.values(cantidades),
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function filtrarRetiros() {
            let filtroPunto = document.getElementById('filtroPuntoVenta').value.toLowerCase();
            let filtroReg = document.getElementById('filtroRegional').value.toLowerCase();

            let tabla = document.getElementById('tablaRetiros');
            tabla.innerHTML = '';
            retiros.filter(ret => 
                ret.puntoVenta.toLowerCase().includes(filtroPunto) && 
                ret.regional.toLowerCase().includes(filtroReg)
            ).forEach(ret => {
                let row = `<tr>
                    <td>${ret.cedula}</td>
                    <td>${ret.nombre}</td>
                    <td>${ret.centroCosto}</td>
                    <td>${ret.motivoRetiro}</td>
                    <td>${ret.fechaRetiro}</td>
                    <td>${ret.fechaReporte}</td>
                    <td>${ret.puntoVenta}</td>
                    <td>${ret.regional}</td>
                    <td>${ret.observaciones}</td>
                </tr>`;
                tabla.innerHTML += row;
            });
        }
    </script>
</body>
</html>
